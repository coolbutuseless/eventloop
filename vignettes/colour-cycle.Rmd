---
title: "Colour Cycle"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Colour Cycle}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, eval = FALSE}
library(eventloop)

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
colours <- rainbow(100)
latch   <- FALSE

colour_cycle <- function(event, mouse_x, mouse_y, frame_num, fps_actual,
                         fps_taget, dev_width, dev_height, ...) {
  if (!is.null(event)) {
    if (event$type == 'mouse_down') {
      latch <<- TRUE
      msg <- sprintf("(%.1f, %.1f), (%f, %f) %.1f", mouse_x, mouse_y, dev_width, dev_height, fps_actual)
      cat(msg, "\n")
    } else if (event$type == 'mouse_up') {
      latch <<- FALSE
    }
  }

  if (latch) {
    col <- colours[[(frame %% 100) + 1L]]
  } else {
    col <- 'white'
  }

  grid::grid.rect(gp = grid::gpar(fill = col))
}


run_loop(colour_cycle, 7, 7)
```
