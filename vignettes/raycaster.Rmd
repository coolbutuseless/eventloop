---
title: "raycaster"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{raycaster}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(eventloop)
library(ggplot2)
library(dplyr)
library(purrr)
library(grid)

N <- 5
mat <- matrix(seq(N*N), N, N)


df <- expand.grid(y = seq(N)-0.5, x = seq(N)-0.5)
df$val <- as.vector(mat)


#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
x0 <- 1
y0 <- 1
theta <- 30 * pi/180
d <- 5
x1 <- x0 + d * cos(theta)
y1 <- y0 + d * sin(theta)


#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
dx <- 1/tan(theta)
if (theta > 0 && theta < pi) {
  dy <- 1
} else {
  dy <- -1
}

if (theta > pi) {
  dx <- -dx
}

horizontal_df <- data.frame(
  x = x0 + seq(5) * dx,
  y = y0 + seq(5) * dy
)

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
dy <-   tan(theta)
if (theta > 3*pi/2 || theta < pi/2) {
  dx <- 1
} else {
  dx <- -1
}

if (theta > pi/2 && theta < 3*pi/2) {
  dy <- -dy
}

vertical_df <- data.frame(
  x = x0 + seq(5) * dx,
  y = y0 + seq(5) * dy
)


#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Plot the DDA view
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
start <- Sys.time()
grid.rect(gp = gpar(fill='white'))
grid.rect(x = df$x, y = df$y, width = 1, height = 1, default.units = 'in')
grid.points(x0, y0, default.units = 'in')
grid.lines(c(x0, x1), c(y0, y1), default.units = 'in')

grid.points(horizontal_df$x, horizontal_df$y, default.units = 'in', 
            gp = gpar(col = 'blue'))

grid.points(vertical_df$x, vertical_df$y, default.units = 'in', 
            gp = gpar(col = 'red'))
Sys.time() - start





```
